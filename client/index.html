<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>National Fire - Emergency Vehicles & Equipment</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23D32F2F' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2c.5 0 .9 0 1.4.1a4 4 0 0 1 3.5 3.5c.2 1 .1 2.2-.3 3.4a4 4 0 0 1 2.1 2.1c1.2-.4 2.3-.5 3.4-.3a4 4 0 0 1 3.5 3.5c.4 2.7-2.1 5.8-6.5 7.8-1.3.6-2.8 1-4.1 1.1-1.3.1-2.6 0-3.7-.4A4 4 0 0 1 9 21c-1.1.4-2.4.5-3.7.4-1.3-.1-2.8-.5-4.1-1.1-4.4-2-6.9-5.1-6.5-7.8a4 4 0 0 1 3.5-3.5c1.1-.2 2.3-.1 3.4.3a4 4 0 0 1 2.1-2.1c-.4-1.2-.5-2.3-.3-3.4a4 4 0 0 1 3.5-3.5c.5-.1.9-.1 1.4-.1Z'/%3E%3Cpath d='M12 7c1.5 0 2.3.8 2.7 1.7'/%3E%3Cpath d='M9.3 8.7c.4-.9 1.2-1.7 2.7-1.7'/%3E%3Cpath d='M7.8 15.1c-1.1 0-2-.9-2-2 0-1.2.9-2 2-2h8.4c1.1 0 2 .9 2 2 0 1.1-.9 2-2 2'/%3E%3Cpath d='M12 7v10'/%3E%3Cpath d='M4.5 13a2.5 2.5 0 0 0 0-5'/%3E%3Cpath d='M19.5 13a2.5 2.5 0 0 1 0-5'/%3E%3C/svg%3E" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Conditional Botpress AI Chatbot Widget - Only loads on public pages -->
    <script>
      // For SPAs, we need to load the chatbot and then manage its visibility
      // Load the chatbot scripts
      const s1 = document.createElement('script');
      s1.src = 'https://cdn.botpress.cloud/webchat/v3.2/inject.js';
      s1.defer = true;
      document.body.appendChild(s1);

      const s2 = document.createElement('script');
      s2.src = 'https://files.bpcontent.cloud/2024/11/14/15/20241114153714-Q3U0U143.js';
      s2.defer = true;
      document.body.appendChild(s2);

      // Function to hide/show chatbot based on current route
      function manageChatbotVisibility() {
        const currentPath = window.location.pathname;
        const isRestrictedPage = currentPath.startsWith('/admin') || currentPath.startsWith('/login');
        
        // Find chatbot elements
        const chatElements = [
          document.querySelector('[data-testid="botpress-chat"]'),
          document.querySelector('#bp-web-widget'),
          document.querySelector('.bp-widget'),
          document.querySelector('iframe[src*="botpress"]'),
          document.querySelector('[id*="botpress"]'),
          document.querySelector('[class*="botpress"]'),
          document.querySelector('.webchat-container'),
          document.querySelector('#webchat-root'),
          document.querySelector('#fab-root')
        ].filter(Boolean);
        
        chatElements.forEach(element => {
          if (isRestrictedPage) {
            element.style.display = 'none';
            element.style.visibility = 'hidden';
            element.style.opacity = '0';
          } else {
            element.style.display = '';
            element.style.visibility = '';
            element.style.opacity = '';
          }
        });
        
        // Find any div containing botpress or webchat
        document.querySelectorAll('div').forEach(div => {
          if (div.innerHTML && (div.innerHTML.includes('botpress') || div.innerHTML.includes('webchat'))) {
            if (isRestrictedPage) {
              div.style.display = 'none';
            } else {
              div.style.display = '';
            }
          }
        });
      }

      // Wait for chatbot to load and then manage visibility
      window.addEventListener('load', function() {
        setTimeout(function() {
          if (window.botpress) {
            console.log('âœ“ Botpress chatbot loaded successfully');
            manageChatbotVisibility();
            
            // Watch for route changes in SPA
            let currentPath = window.location.pathname;
            setInterval(function() {
              if (window.location.pathname !== currentPath) {
                currentPath = window.location.pathname;
                setTimeout(manageChatbotVisibility, 100);
                setTimeout(manageChatbotVisibility, 500);
              }
            }, 200);
          }
        }, 2000);
      });
    </script>
    
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>
